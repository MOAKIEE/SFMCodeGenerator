<Window x:Class="SFMCodeGenerator.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:SFMCodeGenerator.ViewModels"
        xmlns:models="clr-namespace:SFMCodeGenerator.Models"
        Title="SFM Code Generator - 超级工厂管理器代码生成器" 
        Height="800" Width="1300"
        MinHeight="600" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="360"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧配置面板 -->
        <Border Grid.Column="0" 
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,1,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="16">
                    
                    <!-- 程序名称 -->
                    <TextBlock Text="程序名称" Style="{StaticResource HeaderLabel}"/>
                    <TextBox Text="{Binding Program.Name, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource DefaultTextBox}"
                             Margin="0,0,0,16"/>

                    <!-- 模板 -->
                    <TextBlock Text="快速模板" Style="{StaticResource HeaderLabel}"/>
                    <WrapPanel Margin="0,0,0,16">
                        <Button Content="简单移动" Style="{StaticResource SecondaryButton}" 
                                Command="{Binding LoadTemplateCommand}" CommandParameter="simple_move"
                                Margin="0,0,8,8"/>
                        <Button Content="自动熔炼" Style="{StaticResource SecondaryButton}"
                                Command="{Binding LoadTemplateCommand}" CommandParameter="smelting"
                                Margin="0,0,8,8"/>
                        <Button Content="自动分类" Style="{StaticResource SecondaryButton}"
                                Command="{Binding LoadTemplateCommand}" CommandParameter="sorting"
                                Margin="0,0,8,8"/>
                        <Button Content="流体传输" Style="{StaticResource SecondaryButton}"
                                Command="{Binding LoadTemplateCommand}" CommandParameter="fluid"
                                Margin="0,0,8,8"/>
                    </WrapPanel>

                    <!-- 触发器设置 -->
                    <GroupBox Header="触发器设置" Style="{StaticResource SettingsGroupBox}">
                        <StackPanel>
                            <TextBlock Text="触发器类型" Style="{StaticResource SubHeaderLabel}"/>
                            <ComboBox ItemsSource="{Binding TriggerTypes}"
                                      SelectedItem="{Binding TriggerType}"
                                      Style="{StaticResource DefaultComboBox}"
                                      Margin="0,0,0,8"/>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="间隔" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding TriggerInterval, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="单位" Style="{StaticResource SubHeaderLabel}"/>
                                    <ComboBox ItemsSource="{Binding TimeUnits}"
                                              SelectedItem="{Binding TriggerTimeUnit}"
                                              Style="{StaticResource DefaultComboBox}"/>
                                </StackPanel>
                            </Grid>

                            <CheckBox Content="全局触发器 (global)" 
                                      IsChecked="{Binding TriggerIsGlobal}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>

                            <TextBlock Text="偏移量 (offset)" Style="{StaticResource SubHeaderLabel}"/>
                            <TextBox Text="{Binding TriggerOffset, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource DefaultTextBox}"
                                     Margin="0,0,0,8"/>

                            <Button Content="添加触发器" 
                                    Style="{StaticResource PrimaryButton}"
                                    Command="{Binding AddNewTriggerCommand}"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- 触发器列表 -->
                    <GroupBox Header="触发器列表" Style="{StaticResource SettingsGroupBox}">
                        <StackPanel>
                            <ListBox ItemsSource="{Binding Program.Triggers}"
                                     SelectedItem="{Binding SelectedTrigger}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     MaxHeight="120">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Foreground="{StaticResource TextPrimaryBrush}">
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} {1} {2}">
                                                    <Binding Path="TriggerType"/>
                                                    <Binding Path="Interval"/>
                                                    <Binding Path="TimeUnit"/>
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            <Button Content="删除选中触发器" 
                                    Style="{StaticResource SecondaryButton}"
                                    Command="{Binding RemoveTriggerCommand}"
                                    Margin="0,8,0,0"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- INPUT语句 -->
                    <GroupBox Header="INPUT 语句" Style="{StaticResource SettingsGroupBox}">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="标签" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding InputLabel, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="数量" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding InputQuantity, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="保留 (retain)" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding InputRetention, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="方向 (side)" Style="{StaticResource SubHeaderLabel}"/>
                                    <ComboBox ItemsSource="{Binding Sides}"
                                              SelectedItem="{Binding InputSide}"
                                              Style="{StaticResource DefaultComboBox}"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="物品ID" Style="{StaticResource SubHeaderLabel}"/>
                            <ComboBox IsEditable="True"
                                      Text="{Binding InputResourceId, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding CommonItems}"
                                      Style="{StaticResource DefaultComboBox}"
                                      Margin="0,0,0,8"/>

                            <CheckBox Content="使用 EACH (对每个容器单独处理)" 
                                      IsChecked="{Binding InputUseEach}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>

                            <Button Content="添加 INPUT" 
                                    Style="{StaticResource PrimaryButton}"
                                    Command="{Binding AddInputStatementCommand}"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- OUTPUT语句 -->
                    <GroupBox Header="OUTPUT 语句" Style="{StaticResource SettingsGroupBox}">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="标签" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding OutputLabel, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="数量" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding OutputQuantity, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="保留 (retain)" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding OutputRetention, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="方向 (side)" Style="{StaticResource SubHeaderLabel}"/>
                                    <ComboBox ItemsSource="{Binding Sides}"
                                              SelectedItem="{Binding OutputSide}"
                                              Style="{StaticResource DefaultComboBox}"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="物品ID" Style="{StaticResource SubHeaderLabel}"/>
                            <ComboBox IsEditable="True"
                                      Text="{Binding OutputResourceId, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding CommonItems}"
                                      Style="{StaticResource DefaultComboBox}"
                                      Margin="0,0,0,8"/>

                            <CheckBox Content="使用 EACH (每个容器接收)" 
                                      IsChecked="{Binding OutputUseEach}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>

                            <Button Content="添加 OUTPUT" 
                                    Style="{StaticResource PrimaryButton}"
                                    Command="{Binding AddOutputStatementCommand}"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- IF条件 -->
                    <GroupBox Header="IF 条件语句" Style="{StaticResource SettingsGroupBox}">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="集合操作" Style="{StaticResource SubHeaderLabel}"/>
                                    <ComboBox ItemsSource="{Binding SetOperators}"
                                              SelectedItem="{Binding IfSetOperator}"
                                              Style="{StaticResource DefaultComboBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="标签" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding IfConditionLabel, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                    <TextBlock Text="比较运算符" Style="{StaticResource SubHeaderLabel}"/>
                                    <ComboBox ItemsSource="{Binding ComparisonOperators}"
                                              SelectedItem="{Binding IfComparisonOperator}"
                                              Style="{StaticResource DefaultComboBox}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                    <TextBlock Text="数量" Style="{StaticResource SubHeaderLabel}"/>
                                    <TextBox Text="{Binding IfQuantity, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DefaultTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="物品ID" Style="{StaticResource SubHeaderLabel}"/>
                            <ComboBox IsEditable="True"
                                      Text="{Binding IfResourceId, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding CommonItems}"
                                      Style="{StaticResource DefaultComboBox}"
                                      Margin="0,0,0,8"/>

                            <Button Content="添加 IF" 
                                    Style="{StaticResource PrimaryButton}"
                                    Command="{Binding AddIfStatementCommand}"/>
                        </StackPanel>
                    </GroupBox>

                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- 右侧代码预览 -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 工具栏 -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundLightBrush}"
                    Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="生成的代码" 
                               FontSize="18" 
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               VerticalAlignment="Center"/>

                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Content="复制" 
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding CopyCodeCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="保存" 
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding SaveToFileCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="清空" 
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding ClearAllCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 代码编辑器 -->
            <TextBox Grid.Row="1"
                     Text="{Binding GeneratedCode, Mode=OneWay}"
                     Style="{StaticResource CodeTextBox}"
                     IsReadOnly="True"
                     Margin="16,8,16,8"/>

            <!-- 语句列表 -->
            <Border Grid.Row="2"
                    Background="{StaticResource BackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    Margin="16,0,16,8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 标题栏 -->
                    <Border Grid.Row="0" 
                            Background="{StaticResource BackgroundLightBrush}"
                            Padding="12,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="当前触发器的语句列表" 
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="↑" 
                                        Style="{StaticResource SecondaryButton}"
                                        Command="{Binding MoveStatementUpCommand}"
                                        Width="32" Padding="4"
                                        Margin="0,0,4,0"/>
                                <Button Content="↓" 
                                        Style="{StaticResource SecondaryButton}"
                                        Command="{Binding MoveStatementDownCommand}"
                                        Width="32" Padding="4"
                                        Margin="0,0,4,0"/>
                                <Button Content="删除" 
                                        Style="{StaticResource SecondaryButton}"
                                        Command="{Binding RemoveStatementCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- 语句列表 -->
                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding SelectedTrigger.Statements}"
                             SelectedItem="{Binding SelectedStatement}"
                             Background="{StaticResource BackgroundBrush}"
                             BorderThickness="0"
                             MaxHeight="120"
                             Padding="8"
                             ItemContainerStyle="{StaticResource StatementListBoxItem}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" 
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           FontFamily="{StaticResource CodeFont}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- 状态栏 -->
            <Border Grid.Row="3" 
                    Background="{StaticResource BackgroundDarkBrush}"
                    Padding="16,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="SFM Code Generator v1.0 - 超级工厂管理器代码生成工具"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"/>

                    <TextBlock Grid.Column="1" 
                               Text="{Binding CharacterCountText}"
                               VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsCharacterCountWarning}" Value="True">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
